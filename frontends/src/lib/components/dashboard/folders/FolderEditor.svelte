<script lang="ts">
	import {
		showAddFolderDrawer,
		folderStore,
		selectedFolder,
		toastStore,
		showFolderRenameDrawer,
	} from "../store";
	import { ClosePanel } from "../icons";
	import { setFolderStore } from "../../../store/storeHelper";
	import { fly } from "svelte/transition";
	import { sendMessage } from "../helper";
	import { onMount } from "svelte";

	export let name = "";
	export let description = "";
	export let addFolder = true;
	let selectedTab = "shared";

	function autofocus(node: any) {
		node.focus();
	}

	const renameFolderFunc = async () => {
		const payload = {
			name: name,
			description: description,
		};
		if ($selectedFolder == undefined) {
			showFolderRenameDrawer.set(false);
			throw new Error("folder not selected");
		}
		// const renameResponse = await renameFolder(payload, $selectedFolder.id);
		await setFolderStore();
		// showFolderRenameDrawer.set(false);
		// const actionMessage = renameResponse.success
		// 	? "Folder Successfully Renamed"
		// 	: "Failed to Rename folder";
		// toastStore.set({
		// 	type: renameResponse.success,
		// 	message: actionMessage,
		// 	show: true,
		// });
	};

	const addFolderFunc = async () => {
		const payload = {
			name: name,
			description: description,
			sharedFolder: selectedTab === "shared",
		};
		console.log("adding folder...");
		// const folderResponse = await createFolder(payload);
		sendMessage("addFolder", { name, description });
		await setFolderStore();
		// for (const folder of $folderStore) {
		// 	if (folder.id == folderResponse.data.folderId) {
		// 		selectedFolder.set(folder);
		// 		break;
		// 	}
		// }
		showAddFolderDrawer.set(false);
		// const actionMessage = folderResponse.success
		// 	? "Folder Successfully Created"
		// 	: "Failed to Create folder";
		// toastStore.set({
		// 	type: folderResponse.success,
		// 	message: actionMessage,
		// 	show: true,
		// });
	};

	const handleClose = () => {
		showFolderRenameDrawer.set(false);
		showAddFolderDrawer.set(false);
	};

	const toggleSelect = (e: any) => {
		selectedTab = e.detail;
	};
	onMount(() => {
		console.log("moundet");
	});
</script>

<form
	class="p-4 bg-osvauld-frameblack border border-osvauld-activeBorder rounded-3xl w-[32rem] h-[25rem] flex flex-col items-start justify-center gap-3"
	on:submit|preventDefault="{addFolder ? addFolderFunc : renameFolderFunc}"
	in:fly
	out:fly>
	<div class="flex justify-between items-center w-full">
		<span class="text-[21px] font-medium text-osvauld-quarzowhite"
			>{addFolder ? "Create Folder" : "Rename Folder"}</span>
		<button
			class="cursor-pointer p-2"
			type="button"
			on:click|preventDefault="{handleClose}">
			<ClosePanel />
		</button>
	</div>

	<div
		class="border-b border-osvauld-iconblack w-[calc(100%+2rem)] -translate-x-4">
	</div>

	<label for="name" class="font-bold text-base text-osvauld-textActive"
		>{addFolder ? "Name:" : "Folder Name"}</label>
	<input
		id="name"
		type="text"
		use:autofocus
		required
		bind:value="{name}"
		class="py-1 rounded-sm items-center text-base bg-osvauld-frameblack border-osvauld-iconblack w-[95%] h-10 mx-2 focus:border-osvauld-iconblack focus:ring-0 form-input"
		autocomplete="off" />

	<label for="description" class="font-bold text-base text-osvauld-textActive"
		>Description:</label>
	<textarea
		id="description"
		bind:value="{description}"
		class="py-1 rounded-sm items-center text-base bg-osvauld-frameblack border-osvauld-iconblack w-[95%] h-20 mx-2 focus:border-osvauld-iconblack focus:ring-0 form-textarea"
	></textarea>
	<div
		class="border-b border-osvauld-iconblack w-[calc(100%+2rem)] -translate-x-4">
	</div>

	<div class="flex justify-end items-center gap-4 w-full">
		<button
			class="text-osvauld-fadedCancel font-medium text-base py-[5px] px-[15px] rounded-md hover:text-osvauld-quarzowhite hover:bg-osvauld-cancelBackground"
			type="button"
			on:click|preventDefault="{handleClose}">Cancel</button>
		<button
			class="border border-osvauld-iconblack py-[5px] px-[15px] text-base font-medium text-osvauld-textActive rounded-md hover:bg-osvauld-carolinablue hover:border-osvauld-carolinablue hover:text-osvauld-frameblack"
			type="submit"
			disabled="{!name}"
			>{$showFolderRenameDrawer ? "Save Changes" : "Add Folder"}</button>
	</div>
</form>
